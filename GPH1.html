<!DOCTYPE html>

<html>

<head>
<style>
	body {
		overflow: hidden;
	}
</style>
</head>

<body> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r74/three.min.js"></script>
	<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
	<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="http://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>


<script>
	var camera, scene, renderer;
	var keyboard = new KeyboardState();

	var mod = new THREE.Object3D();
	var pos = new THREE.Vector3(0, 0, 0);
	var vel = new THREE.Vector3();
	var force = new THREE.Vector3();
	var clock = new THREE.Clock();
	var de = clock.getDelta();
		
	var theta = 0;
	var angle = 0;
	var power = 5;
	var homehit = true;
	var thrust;
		
	var turn = 0;
		
	init();
	animate();

	function init() {
		scene = new THREE.Scene();
		camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
		camera.position.set(0, 200, 200);
		scene.add(camera);
		
		///////////////////////////////////////
		
		//模型
		modelmake();
		
		
		
		////////////////////////////////////////
		
		var light = new THREE.PointLight(0xffffff, 1);
		light.position.set(150, 150, 150);
		scene.add(light);
		var amblight = new THREE.AmbientLight(0x404040); // soft white light
		scene.add(amblight);

		var gridXZ = new THREE.GridHelper(100, 10);
		gridXZ.setColors(new THREE.Color(0xff0000), new THREE.Color(0xffffff));
		scene.add(gridXZ);
		
		renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		renderer.setClearColor(0x888888);

		controls = new THREE.OrbitControls(camera, renderer.domElement);

		document.body.appendChild(renderer.domElement);
		window.addEventListener('resize', onWindowResize, false);

	}
	
	function move(){
		
		
		
		
		
	}
	
	function modelmake(){
		var loader = new THREE.JSONLoader();	
		loader.load("http://stemkoski.github.io/Three.js/models/android.js",function(geometry, materials) {
			var material = new THREE.MeshPhongMaterial(materials);
			mod = new THREE.Mesh(geometry, material);
			mod.scale.set(5, 5, 5);
			mod.castShadow = true;
			mod.receiveShadow = true;
			scene.add(mod);
		});
	}

	function onWindowResize() {
	  camera.aspect = window.innerWidth / window.innerHeight;
	  camera.updateProjectionMatrix();
	  renderer.setSize(window.innerWidth, window.innerHeight);
	}

	function animate() {
	//動作
		thrust = new THREE.Vector3(0, 0, 0).applyAxisAngle(new THREE.Vector3(0, 1, 0), angle+theta).multiplyScalar(power);//阻力
		
		if(power > 0){
			//power -= 0.01;
			force = new THREE.Vector3(1, 0, 0).applyAxisAngle(new THREE.Vector3(0, 1, 0), mod.rotation.y + angle).multiplyScalar(power);
		}
		force.add(vel.clone().multiplyScalar(-0.5));
		
		vel.add(force.clone().multiplyScalar(de/1));
		pos.add(vel.clone().multiplyScalar(de));
		mod.position.copy(pos);
		mod.rotation.y = Math.atan2(-vel.z, vel.x);
		
		console.log("theta = " + theta + " , power = " + power);
		
		if(keyboard.pressed("left")){
			theta += 1;
			theta = theta % 360;
		}
		if(keyboard.pressed("right")){
			theta -= 1;
			theta = theta % 360;
		}
		if(keyboard.pressed("up")){
			if(power <= 45) power = power + 5;
			else power = 50;
		}
		if(keyboard.pressed("down")){
			if(power >= 5) power = power - 5;
			else power = 0;
		}
		if(keyboard.pressed("home")){
			homehit = !homehit;
			if(homehit == false)power = 0;
		}
		if(keyboard.pressed("space")){
			power = 0;
			homehit = false;
		}
		
		angle = Math.atan2();
		
		 keyboard.update();
		controls.update();
		requestAnimationFrame(animate);
		renderer.render(scene, camera);
	  
	}


</script>
</body>

</html>

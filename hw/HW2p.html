<!DOCTYPE html>

<html>

<head>
<style>
#info {
  position: absolute;
  top: 2%;
  width: 100%;
  padding: 10px;
  text-align: center;
  color: #ffff00
}
#gui {
    position: absolute;
    top: 40px;
    left: 20px;
    height: 300px;
}
body {
  overflow: hidden;
}
.folder .dg ul {
  margin-top: 0 !important;
}


</style>
</head>

<body> 
<div id="info">Moving Box
<br/>
   <button id="button" style="width:8%"><img src="http://img.appleuser.com/iTunes-11-icon-1024.jpg"width="100%" height="100%"></button>
   <button id="button2" style="width:8%"><img src="http://tw.downloadicons.net/sites/default/files/eye-70136.png"width="100%" height="100%"></button>
   <button id="button3" style="width:8%"><img src="http://amitdanzkool.com/images/dancer2.png"width="100%" height="100%"></button>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r74/three.min.js"></script>
<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js">
<script src="https://code.jquery.com/jquery-2.1.4.min.js">
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js"></script>

  <audio id="audio" src="http://homepage.ttu.edu.tw/u10206202/221135.mp3" preload="auto" loop ></audio>
  


<script>
var camera, scene, renderer;
var head = new THREE.Object3D();
var body = new THREE.Object3D();
var lid = new THREE.Object3D();
var lid2 = new THREE.Object3D();
var leg = new THREE.Object3D();
var hand = new THREE.Object3D();
var all = new THREE.Object3D();
var H, B;

var art = new THREE.Object3D();
var mvhan = new THREE.Object3D();
var mvhanl = new THREE.Object3D();
var mvhad = new THREE.Object3D();
var mvleg = new THREE.Object3D();
var mvlegl = new THREE.Object3D();

var push = document.getElementById('button');
var push2 = document.getElementById('button2');
var push3 = document.getElementById('button3');
var m = 1, sig = 0, move = 1;
var angle = 0;
var clock2 = new THREE.Clock(true);

var music = function() {
	if(m == 0) {
  	audio.play();
    clock.start();
    move = 1;
    m = 1;
    }
  else {
  	audio.pause();
    clock.stop();
    move = 2;
    m = 0;
    }
};

var sight = function() {
	if(sig == 0)   {
  	sig = 1;
  }
  else {
    sig = 0;
    }
};

var act = function() {
	if(move == 0) {
  	audio.play();
    clock.start();
  	move = 1;
    m = 1;
  }
  else {
  	audio.pause();
    clock.stop();
  	move = 0;
    m = 0;
  }
};

var clock = new THREE.Clock();
var period = 7.69;
var pose1 = {
	hx: 0,hy: 0,hz: 0,
  hrx: 0,hrz: 0,hlx: 0,hlz: 0,
  bx: 0,bz: 0,
  lrx: 0,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 5,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose2 = {
	hx: 0,hy: 1.4,hz: 0,
  hrx: -1,hrz: 1,hlx: 0,hlz: 0,
  bx: 0.2,bz: 0,
  lrx: -1,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 6.5,allb: 0,
  ax: 0,ay: 1,az: 0
};
var pose3 = {
	hx: 0,hy: 1,hz: 0,
  hrx: -1,hrz: 1,hlx: -1,hlz: -1 ,
  bx: 0,bz: 0.2,
  lrx: 0,lrz: 0 ,llx: 0,llz: 0,
  alls: 0,allh: 5,allb: 0,
  ax: 0,ay: 0.5,az: 0
};
var pose4 = {
	hx: 0,hy: -1.4,hz: 0,
  hrx: 0,hrz: 0 ,hlx: -1,hlz: -1 ,
  bx: -0.2,bz: 0,
  lrx: 0,lrz: 0,llx: -1,llz: 0,
  alls: 0,allh: 6.5,allb: 0,
  ax: 0,ay: -1,az: 0
};
var pose5 = {
	hx: 0,hy: -1,hz: 0,
  hrx: -1,hrz: 1,hlx: -1,hlz: -1,
  bx: 0,bz: -0.2,
  lrx: 0,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 5,allb: 0,
  ax: 0,ay: -0.5,az: 0
};
var pose6 = {
	hx: 0.1,hy: 0,hz: -0.2,
  hrx: -1,hrz: 0.2,hlx: -1,hlz: 0.2,
  bx: 0,bz: 0.1,
  lrx: -1,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 6.5,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose7 = {
	hx: 0,hy: 0,hz: 0,
  hrx: 0,hrz: 0,hlx: 0,hlz: 0,
  bx: 0,bz: 0.1,
  lrx: -1,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 6.5,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose8 = {
	hx: 0.1,hy: 0,hz: 0.2,
  hrx: -1,hrz: -0.2,hlx: -1,hlz: -0.2,
  bx: 0,bz: -0.1,
  lrx: 0,lrz: 0,llx: -1.2,llz: 0,
  alls: 0,allh: 6.5,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose9 = {
	hx: 0,hy: 0,hz: 0,
  hrx: 0,hrz: 1.5,hlx: 0,hlz: 0,
  bx: 0,bz: -0.1,
  lrx: 0,lrz: 0,llx: -1,llz: 0,
  alls: 0,allh: 6,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose10 = {
	hx: 0,hy: 0,hz: 0,
  hrx: 0,hrz: 1.5,hlx: 0,hlz: -1.5,
  bx: 0,bz: 0,
  lrx: 0,lrz: 0,llx: 0,llz: 0,
  alls: 0,allh: 5,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose11 = {
	hx: 0,hy: 0,hz: 0,
  hrx: 1,hrz: 0,hlx: -1,hlz: 0,
  bx: 0,bz: 0.1,
  lrx: -1,lrz: 0,llx: 1,llz: 0,
  alls: 0,allh: 7,allb: 0,
  ax: 0,ay: 0,az: 0
};
var pose12 = {
	hx: 0,hy: 0,hz: 0,
  hrx: -1,hrz: 1.5,hlx: 1,hlz: 0,
  bx: 0,bz: -0.1,
  lrx: 1,lrz: 0,llx: -1,llz: 0,
  alls: 0,allh: 7,allb: 0,
  ax: 0,ay: 0,az: 0
};

var dkey = [{s: 0, pose: pose1}, {s: 2/32, pose: pose2}, {s: 3/32, pose: pose3}, {s: 4/32, pose: pose1}, {s:6/32, pose: pose4},{s: 7/32, pose: pose5}, {s: 8/32, pose: pose1}, {s: 10/32, pose: pose2}, {s: 11/32, pose: pose3}, {s: 12/32, pose: pose1}, {s: 14/32, pose: pose4}, {s: 15/32, pose: pose5}, {s: 16/32, pose: pose1}, {s: 18/32, pose: pose6}, {s: 19/32, pose: pose1}, {s: 21/32, pose: pose8}, {s: 23/32, pose: pose1}, {s: 25/32, pose: pose7},  {s: 27/32, pose: pose1},  {s: 29/32, pose: pose9},  {s: 31/32, pose: pose10},  {s: 32/32, pose: pose1}];

var wkey = [{s: 0, pose: pose11}, {s: 1/4, pose: pose1}, {s: 2/4, pose: pose12}, {s: 3/4, pose: pose1}, {s: 4/4, pose: pose11}];

var a0 = {
	hx:0,
  hy:0, 
  hz:0, 
  bx:0, 
  bz:0, 
  hrx:0, 
  hrz:0, 
  hlx:0, 
  hlz:0, 
  lrx:0, 
  lrz:0, 
  llx:0, 
  llz:0,
  alls:0,
  allh:0,
  allb:0,
  ax:0,
  ay:0, 
  az:0
 };

init();
animate();
audio.play();


function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
 	camera.position.set(0, 100, 200);
  scene.add(camera);
  
  var gridXZ = new THREE.GridHelper(50, 10);
  gridXZ.setColors(new THREE.Color(0xff00ff), new THREE.Color(0xffffff));
  scene.add(gridXZ);

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  var light = new THREE.PointLight(0xffffff, 0.8);
  light.position.set(150, 150, 150);
  scene.add(light);
  var amblight = new THREE.AmbientLight(0xcccccc); // soft white light
  scene.add(amblight);
  document.body.appendChild(renderer.domElement);
  window.addEventListener('resize', onWindowResize, false);
  ///////////////////////////////////////////////////////////////
  //head
  
  H = headmake();
  H.position.set(0, 29, 0);
  scene.add(H);
  H.rotation.set(a0.hx, a0.hy, a0.hz, 'ZYX');
  all.add(H);
  
  //body
  
  B = bodymake();
  B.position.set(0, 14.5, 0);
  var lidf = lidmake();
  lidf.position.set(0, -9.2, 7.2);
  lidf.rotation.set(-Math.PI/4, 0, 0, 'ZYX');
  B.add(lidf);
  var lidb = lidmake();
  lidb.position.set(0, -9.2, -7.2);
  lidb.rotation.set(Math.PI/4, 0, 0, 'ZYX');
  B.add(lidb);
  var lidl = lid2make();
  lidl.position.set(6.7, -9.8, 0);
  lidl.rotation.set(-Math.PI/10, Math.PI/2, 0, 'ZYX');
  B.add(lidl);
  var lidr = lid2make();
  lidr.position.set(-6.7, -9.8, 0);
  lidr.rotation.set(-Math.PI/10, -Math.PI/2, 0, 'ZYX');
  B.add(lidr);
  all.add(B);
  
//leg
  
  movleR = movethings();
  movleR.rotation.set = (0, 0, Math.PI/2, 'ZYX');
  mvleg.add(movleR);
  var LRG = legmake();
  LRG.position.y = -5;
  mvleg.add(LRG);
  mvleg.position.set(2.8, 4.5, 0);
  mvleg.rotation.set(0, 0, 0, 'ZYX');
  all.add(mvleg);
  
  movleL = movethings();
  movleL.rotation.set = (0, 0, Math.PI/2, 'ZYX');
  mvlegl.add(movleL);
  var LLG = legmake();
  LLG.position.y = -5;
  mvlegl.add(LLG);
  mvlegl.position.set(-2.8, 4.5, 0);
  mvlegl.rotation.set(0, 0, 0, 'ZYX');
  all.add(mvlegl);

//hand

	movhanR = movethings();
  movhanR.rotation.set = (Math.PI/2, 0, 0, 'ZYX');
  mvhan.add(movhanR);
  var HDR = handmake();
  HDR.position.y = -7;
  mvhan.add(HDR);
  mvhan.position.set(7.9, 20, 0);
  mvhan.rotation.set(a0.hrx, 0, 0, 'ZYX');
  mvhan.rotation.x = a0.hrx;
  all.add(mvhan);
  
 	movhanL = movethings();
  movhanL.rotation.set = (Math.PI/2, 0, 0, 'ZYX');
  mvhanl.add(movhanL);
  var HDL = handmake();
  HDL.position.y = -7;
  mvhanl.add(HDL);
  mvhanl.position.set(-7.9, 20, 0);
  mvhanl.rotation.set(0, 0, 0, 'ZYX');
  all.add(mvhanl);
  
  //all
  
  all.position.y = 5;
  scene.add(all);
  
  //button control
  
  push.addEventListener('click', music, false);
  push2.addEventListener('click', sight, false);
  push3.addEventListener('click', act, false);
  
}

function movethings(){
	art = new THREE.Mesh(new THREE.DodecahedronGeometry(2, 1), new THREE.MeshLambertMaterial({color: 0xffffff, wireframe: true}));
  
  return art;
}

function headmake(){
	var box = [];
  
  THREE.ImageUtils.crossOrigin = '';
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
 map:THREE.ImageUtils.loadTexture('http://i.imgur.com/PG3l9pY.png')
  }));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
 map:THREE.ImageUtils.loadTexture('http://i.imgur.com/7U5kOvO.png')
    }));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
 map:THREE.ImageUtils.loadTexture('http://i.imgur.com/JmFDoW8.png')
    }));
  box.push(new THREE.MeshLambertMaterial({visible:false}));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
 map:THREE.ImageUtils.loadTexture('http://i.imgur.com/0r7R8eV.png')
    }));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
 map:THREE.ImageUtils.loadTexture('http://i.imgur.com/q2rISky.png')
    }));
  
  head = new THREE.Mesh(new THREE.BoxGeometry(25, 16, 17.5), new THREE.MeshFaceMaterial(box));
  
  return head;
}

function bodymake(){
	var box = [];
  
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide, 
    color: 0xa78c6b
    }));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide, 
    color: 0xa78c6b
    }));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide, 
    color: 0xa78c6b
    }));
  box.push(new THREE.MeshLambertMaterial({visible:false}));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
    map: THREE.ImageUtils.loadTexture('http://i.imgur.com/AF7k357.png'
  )}));
  box.push(new THREE.MeshLambertMaterial({
  	side:THREE.DoubleSide,
    map: THREE.ImageUtils.loadTexture('http://i.imgur.com/AF7k357.png'
  )}));
  
  body = new THREE.Mesh(new THREE.BoxGeometry(12, 15, 11.5), new THREE.MeshFaceMaterial(box));
  
  return body;
}

function lidmake(){
	lid = new THREE.Mesh(new THREE.PlaneGeometry(12, 5, 2.5), new THREE.MeshLambertMaterial({side:THREE.DoubleSide, color: 0xa88d6c}));
  
  return lid;
}

function lid2make(){
	lid2 = new THREE.Mesh(new THREE.PlaneGeometry(11.5, 5, 2.5), new THREE.MeshLambertMaterial({side:THREE.DoubleSide, color: 0xa88d6c}));
  
  return lid2;
}

function legmake(){
	leg = new THREE.Mesh(new THREE.BoxGeometry(5, 10, 11), new THREE.MeshLambertMaterial({side:THREE.DoubleSide, color: 0xa88d6c}));
  
  return leg;
}

function handmake(){
	hand = new THREE.Mesh(new THREE.BoxGeometry(5, 12, 5), new THREE.MeshLambertMaterial({side:THREE.DoubleSide, color: 0xa88d6c}));
  
  return hand;
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
	controls.update();
  
  if(move == 1){
  	var t = clock.getElapsedTime() % period;
    var s = t / period; // normalized time
    for (var i = dkey.length - 1; i > 0; i--) {
      if (s > dkey[i].s)
        break;
    }
    var tt = (s - dkey[i].s) / (dkey[i + 1].s - dkey[i].s);
    var hhx = (1 - tt)*dkey[i].pose.hx+tt*dkey[i + 1].pose.hx;
    var hhy = (1 - tt)*dkey[i].pose.hy+tt*dkey[i + 1].pose.hy;
    var hhz = (1 - tt)*dkey[i].pose.hz+tt*dkey[i + 1].pose.hz;
    var hbx = (1 - tt) * dkey[i].pose.bx + tt * dkey[i + 1].pose.bx;
    var hbz = (1 - tt) * dkey[i].pose.bz + tt * dkey[i + 1].pose.bz;
    var hhrx = (1 - tt) * dkey[i].pose.hrx + tt * dkey[i + 1].pose.hrx;
    var hhrz = (1 - tt) * dkey[i].pose.hrz + tt * dkey[i + 1].pose.hrz;
    var hhlx = (1 - tt) * dkey[i].pose.hlx + tt * dkey[i + 1].pose.hlx; 
    var hhlz = (1 - tt) * dkey[i].pose.hlz + tt * dkey[i + 1].pose.hlz;
    var hlrx = (1 - tt) * dkey[i].pose.lrx + tt * dkey[i + 1].pose.lrx;
    var hlrz = (1 - tt) * dkey[i].pose.lrz + tt * dkey[i + 1].pose.lrz; 
    var hllx = (1 - tt) * dkey[i].pose.llx + tt * dkey[i + 1].pose.llx;
    var hllz = (1 - tt) * dkey[i].pose.llz + tt * dkey[i + 1].pose.llz;
    var halls = (1 - tt) * dkey[i].pose.alls + tt * dkey[i + 1].pose.alls;
    var hallh = (1 - tt) * dkey[i].pose.allh + tt * dkey[i + 1].pose.allh;
    var hallb = (1 - tt) * dkey[i].pose.allb + tt * dkey[i + 1].pose.allb;
    var hax = (1 - tt) * dkey[i].pose.ax + tt * dkey[i + 1].pose.ax;
    var hay = (1 - tt) * dkey[i].pose.ay + tt * dkey[i + 1].pose.ay;
    var haz = (1 - tt) * dkey[i].pose.az + tt * dkey[i + 1].pose.az;
    

  }
  else if(move == 2) {
  	var hhx = 0;
    var hhy = 0;
    var hhz = 0;
    var hbx = 0;
    var hbz = 0;
    var hhrx = 0;
    var hhrz = 0;
    var hhlx = 0; 
    var hhlz = 0;
    var hlrx = 0;
    var hlrz = 0; 
    var hllx = 0;
    var hllz = 0;
    var halls = 0;
    var hallh = 5;
    var hallb = 0;
    var hax = 0;
    var hay = 0;
    var haz = 0;
  }
  else{
  	var dt = clock2.getDelta();
    var t = clock2.getElapsedTime() % 2;
    var s = t / 2; // normalized time
    for (var i = wkey.length - 1; i > 0; i--) {
      if (s > wkey[i].s)
        break;
    }
    var tt = (s - wkey[i].s) / (wkey[i + 1].s - wkey[i].s);
  	var hhx = 0;
    var hhy = 0;
    var hhz = 0;
    var hbx = (1 - tt) * wkey[i].pose.bx + tt * wkey[i + 1].pose.bx;
    var hbz = 0;
    var hhrx = (1 - tt) * wkey[i].pose.hrx + tt * wkey[i + 1].pose.hrx;
    var hhrz = 0;
    var hhlx = (1 - tt) * wkey[i].pose.hlx + tt * wkey[i + 1].pose.hlx; 
    var hhlz = 0;
    var hlrx = (1 - tt) * wkey[i].pose.lrx + tt * wkey[i + 1].pose.lrx;
    var hlrz = 0; 
    var hllx = (1 - tt) * wkey[i].pose.llx + tt * wkey[i + 1].pose.llx;
    var hllz = 0;
    var halls = 25 * Math.cos(angle);
    var hallh = (1 - tt) * wkey[i].pose.allh + tt * wkey[i + 1].pose.allh;
    var hallb = 25 * Math.sin(angle);
    var hax = 0;
    var hay = -angle;
    var haz = 0;
    
    angle += dt;
  }
 
  
  H.rotation.set(a0.hx+hhx, a0.hy+hhy, a0.hz+hhz);
  mvhan.rotation.set(a0.hrx+hhrx, 0, a0.hrz+hhrz);
  mvhanl.rotation.set(a0.hlx+hhlx, 0, a0.hlz+hhlz);
  B.rotation.set(a0.bx+hbx, 0, a0.bz+hbz);
  mvleg.rotation.set(a0.lrx+hlrx, 0, a0.lrz+hlrz);
  mvlegl.rotation.set(a0.llx+hllx, 0, a0.llz+hllz);
  all.position.set(a0.alls+halls, a0.allh+hallh, a0.allb+hallb);
  all.rotation.set(a0.ax+hax, a0.ay+hay, a0.az+haz);
  
  if(sig == 1){
    camera.position.copy(all.localToWorld(new THREE.Vector3(0, 100, -100)));
    camera.lookAt(all.localToWorld(new THREE.Vector3(0, 0, 0)));
  }
  else camera.position.set(0, 100, 200);
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

</script>
</body>

</html>